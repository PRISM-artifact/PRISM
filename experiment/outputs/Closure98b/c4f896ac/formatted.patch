diff -rwu ORIGINAL_PATH/src/com/google/javascript/jscomp/ReferenceCollectingCallback.java MODIFIED_PATH/src/com/google/javascript/jscomp/ReferenceCollectingCallback.java
--- ORIGINAL_PATH/src/com/google/javascript/jscomp/ReferenceCollectingCallback.java
+++ MODIFIED_PATH/src/com/google/javascript/jscomp/ReferenceCollectingCallback.java
@@ -171,6 +171,13 @@
       if (ref == null) {
         return false;
       }
+      for (BasicBlock block = ref.getBasicBlock(); block != null; block = block.getParent()) {
+        if block.isFunction {
+          break;
+        } else if block.isLoop {
+          return false;
+        }
+      }
       return true;
     }
     private Reference getOneAndOnlyAssignment() {
@@ -299,9 +306,18 @@
   static final class BasicBlock {
     private final BasicBlock parent;
     private final boolean isHoisted;
+    private final boolean isFunction;
+    private final boolean isLoop;
     BasicBlock(BasicBlock parent, Node root) {
       this.parent = parent;
       this.isHoisted = NodeUtil.isHoistedFunctionDeclarationroot;
+      this.isFunction = root.getType() == Token.FUNCTION;
+      if (root.getParent() != null) {
+        int pType = root.getParent().getType();
+        this.isLoop = pType == Token.DO || pType == Token.WHILE || pType == Token.FOR;
+      } else {
+        this.isLoop = false;
+      }
     }
     BasicBlock getParent() {
       return parent;
