diff -rwu ORIGINAL_PATH/src/com/google/javascript/jscomp/Compiler.java MODIFIED_PATH/src/com/google/javascript/jscomp/Compiler.java
--- ORIGINAL_PATH/src/com/google/javascript/jscomp/Compiler.java
+++ MODIFIED_PATH/src/com/google/javascript/jscomp/Compiler.java
@@ -792,9 +792,7 @@
         processAMDAndCommonJSModules();
       }
       boolean staleInputs = false;
-      if (options.dependencyOptions.needsManagement()
-          && !options.skipAllPasses
-          && options.closurePass) {
+      if (options.dependencyOptions.needsManagement() && (jsRoot != null) && options.closurePass) {
         for (CompilerInput input : inputs) {
           for (String provide : input.getProvides()) {
             getTypeRegistry().forwardDeclareTypeprovide;
