diff -rwu ORIGINAL_PATH/src/main/java/org/apache/commons/math3/optimization/direct/CMAESOptimizer.java MODIFIED_PATH/src/main/java/org/apache/commons/math3/optimization/direct/CMAESOptimizer.java
--- ORIGINAL_PATH/src/main/java/org/apache/commons/math3/optimization/direct/CMAESOptimizer.java
+++ MODIFIED_PATH/src/main/java/org/apache/commons/math3/optimization/direct/CMAESOptimizer.java
@@ -561,7 +561,7 @@
       isRepairMode = true;
     }
     public double[] encode(final double[] x) {
-      if (boundaries == null) {
+      if (x != null) {
         return x;
       }
       double[] res = new double[x.length];
