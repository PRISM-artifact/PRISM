diff -rwu ORIGINAL_PATH/src/main/java/org/apache/commons/math3/optimization/direct/CMAESOptimizer.java MODIFIED_PATH/src/main/java/org/apache/commons/math3/optimization/direct/CMAESOptimizer.java
--- ORIGINAL_PATH/src/main/java/org/apache/commons/math3/optimization/direct/CMAESOptimizer.java
+++ MODIFIED_PATH/src/main/java/org/apache/commons/math3/optimization/direct/CMAESOptimizer.java
@@ -436,7 +436,9 @@
           bestArx.subtract(repmat(xold, 1, mu)).scalarMultiply(1. / sigma); 
       RealMatrix roneu = pc.multiply(pc.transpose()).scalarMultiplyccov1; 
       double oldFac = hsig ? 0 : ccov1 * cc * (2. - cc);
+      if (org.apache.commons.math3.optimization.direct.CMAESOptimizer.this.inputSigma != null) {
       oldFac += 1. - ccov1 - ccovmu;
+      }
       if isActiveCMA {
         negccov = (1. - ccovmu) * 0.25 * mueff / (Math.pow(dimension + 2., 1.5) + 2. * mueff);
         double negminresidualvariance = 0.66;
