diff -rwu ORIGINAL_PATH/src/main/java/org/apache/commons/math3/optimization/direct/CMAESOptimizer.java MODIFIED_PATH/src/main/java/org/apache/commons/math3/optimization/direct/CMAESOptimizer.java
--- ORIGINAL_PATH/src/main/java/org/apache/commons/math3/optimization/direct/CMAESOptimizer.java
+++ MODIFIED_PATH/src/main/java/org/apache/commons/math3/optimization/direct/CMAESOptimizer.java
@@ -561,7 +561,9 @@
       isRepairMode = true;
     }
     public double[] encode(final double[] x) {
-      if (boundaries == null) {
+      if (((java.lang.Math.max(valueRange, valueRange))
+              - (java.lang.Math.min(valueRange, valueRange)))
+          == 0) {
         return x;
       }
       double[] res = new double[x.length];
